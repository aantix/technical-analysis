require 'technical-analysis'
require 'spec_helper'

describe 'Indicators' do
  describe "EoM" do
    input_data = SpecHelper.get_test_data(:high, :low, :volume)

    describe 'Ease of Movement' do
      it 'Calculates EoM (14 day)' do
        output = TechnicalAnalysis::Eom.calculate(input_data, period: 14)

        expected_output = [
          {:date=>"2018/10/29", :value=>-21.877975231994814},
          {:date=>"2018/10/30", :value=>-16.275660385464448},
          {:date=>"2018/10/31", :value=>-6.606596973217312},
          {:date=>"2018/11/01", :value=>-10.135395436615527},
          {:date=>"2018/11/02", :value=>-16.2797807192085},
          {:date=>"2018/11/05", :value=>-22.338003197707696},
          {:date=>"2018/11/06", :value=>-22.183583990006944},
          {:date=>"2018/11/07", :value=>-10.367227984759097},
          {:date=>"2018/11/08", :value=>-11.567473480653877},
          {:date=>"2018/11/09", :value=>-16.918604972309158},
          {:date=>"2018/11/12", :value=>-19.69000228424736},
          {:date=>"2018/11/13", :value=>-22.593717509723117},
          {:date=>"2018/11/14", :value=>-26.374761082588922},
          {:date=>"2018/11/15", :value=>-23.978202090280167},
          {:date=>"2018/11/16", :value=>-13.43297156412281},
          {:date=>"2018/11/19", :value=>-16.94506299946587},
          {:date=>"2018/11/20", :value=>-27.37028760395389},
          {:date=>"2018/11/21", :value=>-28.2247053700715},
          {:date=>"2018/11/23", :value=>-27.26817615617346},
          {:date=>"2018/11/26", :value=>-23.02094878061384},
          {:date=>"2018/11/27", :value=>-24.18360420308819},
          {:date=>"2018/11/28", :value=>-23.906907831421474},
          {:date=>"2018/11/29", :value=>-23.304959556064855},
          {:date=>"2018/11/30", :value=>-20.874548142667777},
          {:date=>"2018/12/03", :value=>-11.780616477806618},
          {:date=>"2018/12/04", :value=>-13.565693513893978},
          {:date=>"2018/12/06", :value=>-14.327931101318542},
          {:date=>"2018/12/07", :value=>-15.003602992747133},
          {:date=>"2018/12/10", :value=>-21.68916026908629},
          {:date=>"2018/12/11", :value=>-15.409243349973261},
          {:date=>"2018/12/12", :value=>-8.897024349696329},
          {:date=>"2018/12/13", :value=>-8.427863395925653},
          {:date=>"2018/12/14", :value=>-5.49920090817078},
          {:date=>"2018/12/17", :value=>-5.714363954096145},
          {:date=>"2018/12/18", :value=>-5.583810139052782},
          {:date=>"2018/12/19", :value=>-14.184550665717635},
          {:date=>"2018/12/20", :value=>-19.510117531121228},
          {:date=>"2018/12/21", :value=>-21.640253827328284},
          {:date=>"2018/12/24", :value=>-29.127850557035778},
          {:date=>"2018/12/26", :value=>-21.397258702024285},
          {:date=>"2018/12/27", :value=>-15.149439471732872},
          {:date=>"2018/12/28", :value=>-11.754905920393293},
          {:date=>"2018/12/31", :value=>-7.266128029998595},
          {:date=>"2019/01/02", :value=>-10.542472341445862},
          {:date=>"2019/01/03", :value=>-14.868322149693872},
          {:date=>"2019/01/04", :value=>-13.901372232239117},
          {:date=>"2019/01/07", :value=>-10.852331038262774},
          {:date=>"2019/01/08", :value=>-7.7025655861800235},
          {:date=>"2019/01/09", :value=>-6.497226050937367}
        ]

        expect(output).to eq(expected_output)
      end

      it "Throws exception if not enough data" do
        expect {TechnicalAnalysis::Eom.calculate(input_data, period: input_data.size+2)}.to raise_exception(Validation::ValidationError)
      end
    end
  end
end
