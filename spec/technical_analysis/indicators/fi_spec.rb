require 'technical-analysis'
require 'spec_helper'

describe 'Indicators' do
  describe "FI" do
    input_data = SpecHelper.get_test_data(:close, :volume)

    describe 'Forced Index' do
      it 'Calculates FI' do
        output = TechnicalAnalysis::Fi.calculate(input_data)

        expected_output = [
          {:date=>"2018/10/10", :value=>-431793575.69999963},
          {:date=>"2018/10/11", :value=>-101043431.20000133},
          {:date=>"2018/10/12", :value=>302529938.200001},
          {:date=>"2018/10/15", :value=>-143832137.5},
          {:date=>"2018/10/16", :value=>137964214.49999976},
          {:date=>"2018/10/17", :value=>-21785164.80000018},
          {:date=>"2018/10/18", :value=>-167452577.5999996},
          {:date=>"2018/10/19", :value=>108156545.69999973},
          {:date=>"2018/10/22", :value=>38527063.6000001},
          {:date=>"2018/10/23", :value=>80456833.59999938},
          {:date=>"2018/10/24", :value=>-305539796.7999995},
          {:date=>"2018/10/25", :value=>136718771.40000024},
          {:date=>"2018/10/26", :value=>-165170950.0},
          {:date=>"2018/10/29", :value=>-185597581.4000001},
          {:date=>"2018/10/30", :value=>38677205.80000009},
          {:date=>"2018/10/31", :value=>211373463.60000008},
          {:date=>"2018/11/01", :value=>177925675.1999992},
          {:date=>"2018/11/02", :value=>-1342026294.4000008},
          {:date=>"2018/11/05", :value=>-389165081.2999991},
          {:date=>"2018/11/06", :value=>69268889.60000022},
          {:date=>"2018/11/07", :value=>205742335.19999927},
          {:date=>"2018/11/08", :value=>-36922334.19999948},
          {:date=>"2018/11/09", :value=>-137957395.20000035},
          {:date=>"2018/11/12", :value=>-525207609.0000006},
          {:date=>"2018/11/13", :value=>-90647877.39999989},
          {:date=>"2018/11/14", :value=>-328772056.1999987},
          {:date=>"2018/11/15", :value=>213312352.5999993},
          {:date=>"2018/11/16", :value=>76725619.60000016},
          {:date=>"2018/11/19", :value=>-319277709.3999995},
          {:date=>"2018/11/20", :value=>-600986678.4000016},
          {:date=>"2018/11/21", :value=>-6219247.999999646},
          {:date=>"2018/11/23", :value=>-106071625.30000022},
          {:date=>"2018/11/26", :value=>104063205.60000056},
          {:date=>"2018/11/27", :value=>-15639333.199999813},
          {:date=>"2018/11/28", :value=>307809724.99999946},
          {:date=>"2018/11/29", :value=>-57717776.19999944},
          {:date=>"2018/11/30", :value=>-38241532.19999996},
          {:date=>"2018/12/03", :value=>252955247.99999923},
          {:date=>"2018/12/04", :value=>-334478362.4999998},
          {:date=>"2018/12/06", :value=>-84128672.69999996},
          {:date=>"2018/12/07", :value=>-259658176.39999956},
          {:date=>"2018/12/10", :value=>68552489.99999909},
          {:date=>"2018/12/11", :value=>-44588998.799999945},
          {:date=>"2018/12/12", :value=>16673099.59999996},
          {:date=>"2018/12/13", :value=>58745288.49999982},
          {:date=>"2018/12/14", :value=>-222193369.19999996},
          {:date=>"2018/12/17", :value=>-66605646.799999654},
          {:date=>"2018/12/18", :value=>71894933.69999984},
          {:date=>"2018/12/19", :value=>-246555930.60000032},
          {:date=>"2018/12/20", :value=>-261456813.7999983},
          {:date=>"2018/12/21", :value=>-582537190.0000021},
          {:date=>"2018/12/24", :value=>-144959996.99999917},
          {:date=>"2018/12/26", :value=>601104008.9999986},
          {:date=>"2018/12/27", :value=>-52641026.99999906},
          {:date=>"2018/12/28", :value=>3339247.9999993355},
          {:date=>"2018/12/31", :value=>52094078.90000067},
          {:date=>"2019/01/02", :value=>6414672.59999923},
          {:date=>"2019/01/03", :value=>-1433110593.199999},
          {:date=>"2019/01/04", :value=>348561555.4999996},
          {:date=>"2019/01/07", :value=>-18008575.19999913},
          {:date=>"2019/01/08", :value=>114556606.19999972},
          {:date=>"2019/01/09", :value=>115287987.2000001}
        ]

        expect(output).to eq(expected_output)
      end

      it "Throws exception if not enough data" do
        expect {TechnicalAnalysis::Fi.calculate([])}.to raise_exception(Validation::ValidationError)
      end
    end
  end
end
